// Copyright 2024 The Jule Programming Language.
// Use of this source code is governed by a BSD 3-Clause
// license that can be found in the LICENSE file.

use integ for std::jule::integrated

// Maximum number of bytes of a UTF-8 encoded Unicode character.
// Use this to avoid import std::unicode::utf8.
const UTF_MAX = 4

// Returns byte slice that uses string's allocation.
// Does not performs deallocation.
pub fn stobs(&s: str): []byte {
    ret unsafe { integ::emit[[]byte]("{}.fake_slice()", s) }
}

// Returns byte slice that uses array as allocation pointer.
// Does not performans deallocation.
pub fn atobs[Array, Elem](mut &arr: Array): []Elem {
    unsafe {
        integ::emit("{} slice", []Elem)
        integ::emit("slice.data.alloc = {}", &arr[0])
        integ::emit("slice.data.ref = nullptr")
        integ::emit("slice._slice = slice.data.alloc")
        integ::emit("slice._len = {}", arr.len)
        integ::emit("slice._cap = {}", arr.len)
        ret integ::emit[[]Elem]("slice")
    }
}

pub fn push_to_str_buffer(mut &s: str, b: []byte) {
    unsafe {
        integ::emit("({}).buffer.append(({}).begin(), ({}).end())", s, b, b)
    }
}
