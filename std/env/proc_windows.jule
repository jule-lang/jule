// Copyright 2022-2024 The Jule Programming Language.
// Use of this source code is governed by a BSD 3-Clause
// license that can be found in the LICENSE file.

use integ for std::jule::integrated
use std::sys::{
    MAX_PATH,
    GetCurrentDirectory,
    SetCurrentDirectory,
}

// Possible errors:
//  Denied
fn getwd()!: str {
    let mut buf: [MAX_PATH + 1]u16
    n := unsafe { GetCurrentDirectory(u32(len(buf)), &buf[0]) }
    if n == 0 {
        error(getLastOsErrorWindows())
    }
    ret unsafe { integ::U16PtrToStr(&buf[0]) }
}

// Possible errors:
//  Denied NotExist Device
fn chdir(path: str)! {
    utf16Path := integ::UTF16FromStr(path)
    if unsafe { SetCurrentDirectory(&utf16Path[0]) } {
        ret
    }
    error(getLastOsErrorWindows())
}